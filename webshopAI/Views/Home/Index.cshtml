@model Models.ViewModels.HomeViewModel
@{
    ViewData["Title"] = "Home";
}

<div class="container py-4">
    <!-- Owner Hero Card with enhanced styling for background -->
    <div class="card mb-5 shadow-lg border-0" style="background: rgba(20, 25, 34, 0.65); backdrop-filter: blur(8px);">
        <div class="row g-0 align-items-center">
            <div class="col-12 col-md-5">
                <img src="@Url.Content("~/images/about/glork.png")" alt="Glork, Owner of Nebula Space Parts" class="img-fluid w-100 h-100" style="object-fit: cover; min-height: 260px;" asp-append-version="true" onerror="this.style.display='none'; this.parentElement.classList.add('p-4');" />
            </div>
            <div class="col-12 col-md-7">
                <div class="card-body p-4 p-lg-5">
                    <h1 class="display-6 mb-3">Welcome To Our Intergalactic Online Store, Human!</h1>
                    <p class="lead mb-2" style="color: var(--primary-cyan) !important;">The Big Glork Greets You!</p>
                    <p class="mb-0 text-muted">Browse premium-grade spacecraft components engineered to keep your ship faster, safer, and mission-ready across the galaxy.</p>
                </div>
            </div>
        </div>
    </div>

    <h2 class="mb-3">Featured Spacecraft Parts</h2>

    @if (Model.FeaturedProducts != null && Model.FeaturedProducts.Any())
    {
        <div id="featuredCarousel" class="carousel slide featured-carousel mb-4" data-bs-ride="carousel">
            <div class="carousel-indicators">
                @for (int i = 0; i < Model.FeaturedProducts.Count; i++)
                {
                    <button type="button" data-bs-target="#featuredCarousel" data-bs-slide-to="@i" class="@(i == 0 ? "active" : null)" aria-current="@(i == 0 ? "true" : null)" aria-label="Slide @(i + 1)"></button>
                }
            </div>
            <div class="carousel-inner">
                @for (int i = 0; i < Model.FeaturedProducts.Count; i++)
                {
                    var p = Model.FeaturedProducts[i];
                    var imgSrc = string.IsNullOrWhiteSpace(p.ImageUrl)
                        ? Url.Content("~/images/products/placeholder.svg")
                        : (p.ImageUrl.StartsWith("http", StringComparison.OrdinalIgnoreCase)
                            ? p.ImageUrl
                            : Url.Content(p.ImageUrl.StartsWith("~") || p.ImageUrl.StartsWith("/")
                                ? p.ImageUrl
                                : $"~/images/products/{p.ImageUrl}"));
                    <div class="carousel-item @(i == 0 ? "active" : null)" data-index="@i">
                        <img src="@imgSrc" asp-append-version="true" class="d-block w-100 carousel-img" alt="@p.Name" />
                        <div class="carousel-caption d-none d-md-block text-start">
                            <div class="bg-dark bg-opacity-50 rounded p-3" style="backdrop-filter: blur(6px);">
                                <h5 class="mb-1">@p.Name</h5>
                                <p class="mb-2">@p.Description</p>
                                <div class="d-flex align-items-center gap-3">
                                    <span class="fw-bold mb-0">@p.Price.ToString("C")</span>
                                    <a asp-controller="Products" asp-action="Details" asp-route-id="@p.Id" class="btn btn-primary btn-sm">Details</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#featuredCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#featuredCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        @section Scripts {
            <script>
                (function () {
                    const el = document.getElementById('featuredCarousel');
                    if (!el) return;
                    const carousel = bootstrap.Carousel.getOrCreateInstance(el);

                    function setNeighbors() {
                        const items = Array.from(el.querySelectorAll('.carousel-item'));
                        const active = el.querySelector('.carousel-item.active');
                        if (!active) return;
                        const idx = parseInt(active.getAttribute('data-index'));
                        items.forEach(i => i.classList.remove('prev', 'next'));
                        const prevIdx = (idx - 1 + items.length) % items.length;
                        const nextIdx = (idx + 1) % items.length;
                        items[prevIdx]?.classList.add('prev');
                        items[nextIdx]?.classList.add('next');
                    }

                    el.addEventListener('slid.bs.carousel', setNeighbors);
                    // initial
                    setNeighbors();

                    // allow clicking previews to navigate
                    el.addEventListener('click', function (e) {
                        const prev = e.target.closest('.carousel-item.prev');
                        const next = e.target.closest('.carousel-item.next');
                        if (prev) { carousel.prev(); }
                        if (next) { carousel.next(); }
                    });
                })();
            </script>
        }
    }
    else
    {
        <div class="alert alert-info" style="background: rgba(26, 77, 92, 0.65); backdrop-filter: blur(8px);">No featured products at the moment. Please check back soon.</div>
    }
</div>
